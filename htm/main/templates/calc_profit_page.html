{% load static %}

<!DOCTYPE html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet", href="{% static 'project_base.css' %}">
    <link rel="stylesheet", href="{% static 'calc_profit_page.css' %}">

    <script>
        function create() {
            var par = document.querySelector("form.forms");
            var add = document.createElement("h2");
            add.appendChild(document.createTextNode("testik"));
            par.appendChild(add);
        }
        
        function inc() {
            var inp = document.querySelector("input[name='cnt']");
            el.value = parseInt(el.value) + 1;
            // alert(el.value);
        }

        function on_page_init() {
            var inp = document.querySelector("input[name='form-0-cnt']");
            // alert(inp.name);
            inp.value = "{{cnt}}";

            for (let i = 0; i < "{{cnt}}"; i++) {
                var q = "input[name='form-" + String(i) +"-quantity']";
                var v = document.querySelector(q);
                if (v.value == "") v.value = "1";
                if (i > 0) {
                    var eq = "input[name='form-" + String(i) + "-electricity']";
                    var e = document.querySelector(eq);
                    // e.styles.visible = false
                    e.value = 1;
                    e.style.visibility = "hidden";
                    e.style.width = "0px";
                    e.style.margin = "0px";
                    // alert(e);
                    eq = "label[for='id_form-" + String(i) + "-electricity']";
                    e = document.querySelector(eq);
                    // alert(e);
                    // e.styles.visible = false
                    // e.value = 1;
                    e.style.visibility = "hidden";
                    e.innerHTML = "";
    
                    // e.style.width = "0px";
                }
            }
            var q = "button[name='del 1']";
            var v = document.querySelector(q);
            v.style.visibility = "hidden";
        }

        function restore_types(i, val) {
            // alert(i);
            var q = "select[name='form-" + String(parseInt(i) - 1) +"-cards']";
            var v = document.querySelector(q);
            v.value = val;
            // alert(i + " " + val + " " + q);
        }

        function restore_quantities(i, val) {
            // alert(i);
            var q = "input[name='form-" + String(parseInt(i) - 1) +"-quantity']";
            var v = document.querySelector(q);
            v.value = val;
            // alert(i + " " + val + " " + q);
        }
    </script>
</head>
<body onload="on_page_init()">
    <a class="a1" id="back_btn" href="/">Назад</a>
    <h1 id="mp_header">Расчет доходности вашей конфигурации</h1>
    <div>
        <form class="forms" method="POST">
            {% csrf_token %}
            <!-- <input class="cnt" type="integer" value="1"> -->
            {% for el in forms %}
                <div class="form">
                    <button type="submit" name="del {{forloop.counter}}" id="del_card_btn">✕</button>
                    {{el}}
                    <br>
                </div>
                
            {% endfor %}
            <button name="inc" type="submit" onclick="inc()" class="trans_btn">Добавить карту</button>
            <br>
            <button name="sbm" class="beautiful_btn" type="submit">Рассчитать</button>
        </form>

        <br>
        <br>

        <h2 id="mp_header">Таблица прибыли</h2>
        <div class="profit_tbl">
            <div class="profit_tbl_row">
                <div class="profit_tbl_col">
                    Монета
                </div>
                <div class="profit_tbl_col">
                    Хешрейт фермы
                </div>
                <div class="profit_tbl_col">
                    Прибыль в криптовалюте, 24ч
                </div>
                <div class="profit_tbl_col">
                    Прибыль в долларах, 24ч
                </div>
                <div class="profit_tbl_col">
                    Прибыль в долларах, 30д
                </div>
            </div>
            {% for name, val in profit.items %}
                <div class="profit_tbl_row">
                    <div class="profit_tbl_col">
                        {{name}}
                    </div>
                    <div class="profit_tbl_col">
                        {{val.0}}
                    </div>
                    <div class="profit_tbl_col">
                        {{val.1}}
                    </div>
                    <div class="profit_tbl_col">
                        {{val.2}}
                    </div>
                    <div class="profit_tbl_col">
                        {{val.3}}
                    </div>
                </div>
            {% endfor %}
        </div>
        
        
        {% for type in form_vals %}
            <script>restore_types("{{forloop.counter}}", "{{type}}")</script>
        {% endfor %}
        {% for quant in form_quant %}
            <script>restore_quantities("{{forloop.counter}}", "{{quant}}")</script>
        {% endfor %}
    </div>
</body>